{% extends 'base.html' %}

{% block content %}

<div class="modal is-active">
    <div class="modal-background"></div>
    <div class="modal-content">
        <nav class="panel is-inline-block has-background-white">
            <p class="panel-heading">
                <span class="icon"><i class="fab fa-github"></i></span>
                Add Repositories
            </p>
            <div class="panel-block is-hidden">
                <p class="control has-icons-left">
                    <input class="input" type="text" placeholder="Search" />
                    <span class="icon is-left">
                    <i class="fas fa-search" aria-hidden="true"></i>
                  </span>
                </p>
            </div>

            <p class="panel-tabs">
                {% for org in orgs %}
                <a href="{% url 'repositories:show_repo_picker_for_org' org.login %}" class="is-page-loader is-rounded m-2 is-small button {% if org.login == selected_org %}is-link{% endif %}">{{ org.login }}</a>
                {% endfor %}
            </p>

            {# Pagination #}

            <div class="panel-block {% if total_page_count <= 1 %}is-hidden{% endif %}">
                <nav class="pagination is-small" role="navigation" aria-label="pagination">
                    <a href="?page={{ prev_page }}" class="pagination-previous is-page-loader">Previous</a>
                    <a href="?page={{ next_page }}" class="pagination-next is-page-loader">Next page</a>
                    <ul class="pagination-list">
                        <li><a href="?page=1" class="pagination-link is-page-loader {% if current_page == 1 %}is-current{% endif %}" aria-label="Goto page 1">1</a></li>

                        {% if total_page_count < 8 %}
                        {% for middle_page in page_buttons %}
                        <li>
                            <a href="?page={{ middle_page }}"
                               class="pagination-link is-page-loader {% if current_page == middle_page %}is-current{% endif %}"
                               aria-label="Goto page {{ middle_page }}">
                                {{ middle_page }}
                            </a>
                        </li>
                        {% endfor %}
                        {% else %}
                        <li><span class="pagination-ellipsis">&hellip;</span></li>
                        {% for middle_page in page_buttons %}
                        <li>
                            <a href="?page={{ middle_page }}"
                               class="pagination-link is-page-loader {% if current_page == middle_page %}is-current{% endif %}"
                               aria-label="Goto page {{ middle_page }}">
                                {{ middle_page }}
                            </a>
                        </li>
                        {% endfor %}
                        <li><span class="pagination-ellipsis">&hellip;</span></li>
                        {% endif %}

                        <li><a href="?page={{ total_page_count }}" class="pagination-link is-page-loader {% if current_page == total_page_count %}is-current{% endif %}" aria-label="Goto page {{ total_page_count }}">{{ total_page_count }}</a></li>
                    </ul>
                </nav>
            </div>

            {# List of repos for the selected org #}
            {% for repo in repositories %}
            <span class="panel-block">

            <form action="{% url 'repositories:bookmark_repo' repo.owner.login repo.name %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="repo_name" value="{{ repo.name }}" />
                <input type="hidden" name="repo_owner" value="{{ repo.owner.login }}" />
                <button type="submit" class="is-small button mr-3" aria-label="Add Repo">
                    <span class="icon"><i class="fas fa-plus"></i></span>
                </button>
            </form>

            <figure class="image is-24x24 mr-2">
              <img
                      src="{{ repo.owner.avatar_url }}"
                      alt="{{ repo.owner.login }}"
                      class="is-rounded" />
            </figure>

            <a href="{{ repo.html_url }}" target="_blank">
                {{ repo.name }}
            </a>

        </span>

            {% endfor %}
            <div class="panel-block">
                <a class="button is-dark is-outlined is-fullwidth" href="{% url 'repositories:repo_overview' %}">
                    Close
                </a>
            </div>
        </nav>

    </div>

</div>


    <script>
        $(document).ready(function() {
            $('.is-page-loader').click(function() {
                $(this).addClass('is-loading').attr('disabled', 'disabled');
            });
        });
    </script>

{% endblock %}